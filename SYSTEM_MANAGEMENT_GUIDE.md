# 系統管理面板使用指南

**文檔版本**: v1.0
**建立日期**: 2025-11-09
**適用對象**: Super Admin 系統管理員

---

## 📋 **概述**

系統管理面板是為 592Meal 系統的 Super Admin 專門設計的獨立管理介面，提供完整的系統統計數據查看、訂單管理等功能。

### 🔐 **權限要求**

- **角色**: Super Admin
- **權限**:
  - `access_system_management` - 訪問系統管理面板
  - `view_system_statistics` - 查看系統統計計
  - `manage_orders` - 管理訂單
  - `manual_payment_processing` - 手動處理付款

---

## 🏠 **系統管理頁面位置**

- **導航路徑**: `系統管理` → `系統管理面板`
- **URL**: `/admin/system-management`
- **圖標**: 📊 (chart-bar)

---

## 📊 **統計數據功能**

### **總體統計卡片**

1. **總註冊人數**
   - 顯示系統中所有用戶的總數
   - 包含今日新增人數統計

2. **有訂閱人數**
   - 目前訂閱未過期的用戶數量
   - 即時更新訂閱狀態

3. **總收入金額**
   - 系統累計的所有訂閱收入
   - 顯示新台幣格式

4. **總訂單數量**
   - 系統中所有訂單的總數
   - 包含所有狀態的訂單

### **訂單狀態統計**

- **已完成**: 成功處理的訂單
- **待處理**: 等待處理的訂單
- **失敗**: 處理失敗的訂單
- **已取消**: 被取消的訂單

### **今日統計**

- **新註冊用戶**: 今日新註冊的用戶數量
- **網站登入成功**: 今日前台登入成功次數
- **後台登入成功**: 今日後台登入成功次數
- **後台登入失敗**: 今日後台登入失敗次數

### **訂閱統計**

- **活躍訂閱**: 目前有效的訂閱數量
- **已過期訂閱**: 已經過期的訂閱數量
- **7天內到期**: 即將在7天內到期的訂閱

### **收入統計**

- **本月收入**: 當月份的收入總額
- **上月收入**: 上月份的收入總額
- **總收入**: 系統累計收入

### **每日註冊趨勢**

顯示最近7天的詳細統計數據，包括：
- 日期
- 新註冊人數
- 網站登入次數
- 後台登入成功/失敗次數

---

## 📦 **訂單管理功能**

### **訂單列表**

系統管理面板底部提供完整的訂單管理表格，包含：

#### **顯示欄位**
- **訂單編號**: 唯一訂單ID
- **用戶**: 訂單所屬用戶
- **金額**: 訂單金額 (NT$)
- **狀態**: 訂單當前狀態
- **付款方式**: 使用的付款方式
- **創建時間**: 訂單創建時間
- **付款時間**: 實際付款時間

#### **篩選功能**

1. **訂單狀態篩選**
   - 待處理
   - 已付款
   - 已完成
   - 失敗
   - 已取消

2. **付款方式篩選**
   - 信用卡
   - 超商代碼
   - 超商條碼
   - 手動處理

3. **日期篩選**
   - 可選擇開始和結束日期
   - 精確到日期級別

### **訂單操作**

#### **標記為已付款**
- **適用對象**: 狀態為「待處理」的訂單
- **功能**: 手動將訂單標記為已付款並自動更新用戶訂閱期限
- **操作流程**:
  1. 點擊訂單的「標記為已付款」按鈕
  2. 可選擇填寫備註說明
  3. 確認後系統自動：
     - 更新訂單狀態為「已付款」
     - 記錄付款時間
     - 根據金額計算訂閱月數（每個月NT$50）
     - 更新用戶的訂閱到期日
     - 創建付款日誌記錄

#### **查看詳情**
- 顯示訂單的完整信息
- 包含訂單項目、付款記錄等
- 彈出式模態窗口顯示

#### **刪除訂單**
- 完全刪除訂單記錄
- 謹慎使用，建議先取消訂單而非刪除

#### **批量操作**
- 可選擇多個訂單進行批量處理
- 支援批量標記為已付款

---

## ⚙️ **自動化功能**

### **登入日誌記錄**

系統會自動記錄所有登入嘗試：

#### **網站前台登入**
- 記錄到 `website_login_logs` 表
- 包含：Email、IP地址、User Agent、成功/失敗狀態

#### **後台管理登入**
- 記錄到 `admin_login_logs` 表
- 包含：用戶ID、Email、IP地址、成功/失敗狀態

### **統計數據更新**

- **即時更新**: 大部分統計數據實時計算
- **60秒輪詢**: 訂單表格每60秒自動更新
- **手動整理**: 可點擊「重新整理統計」按鈕手動更新

---

## 🚨 **注意事項**

### **安全性**
1. **權限控制**: 嚴格的權限檢查，只有擁有正確權限的 Super Admin 才能訪問
2. **操作記錄**: 所有手動付款操作都會記錄詳細日誌
3. **IP記錄**: 登入嘗試都會記錄IP地址以便安全審計

### **數據準確性**
1. **訂閱計算**: 手動處理付款時，系統會自動根據金額計算正確的訂閱月數
2. **到期日處理**:
   - 如果用戶現有訂閱未過期，從現有到期日往後加
   - 如果已過期或無訂閱，從今天開始計算
3. **金額驗證**: 系統會驗證金額與月數的對應關係（每個月NT$50）

### **操作建議**
1. **謹慎操作**: 手動標記付款會直接影響用戶訂閱狀態，請確認後再操作
2. **備註說明**: 建議在處理手動付款時填寫清楚的備註說明
3. **定期檢查**: 建議定期檢查「待處理」訂單，及時處理付款問題

---

## 🐛 **故障排除**

### **常見問題**

1. **無法訪問系統管理頁面**
   - 檢查是否為 Super Admin 角色
   - 檢查是否擁有 `access_system_management` 權限

2. **統計數據不正確**
   - 點擊「重新整理統計」按鈕
   - 檢查相關資料庫表是否有正確數據

3. **手動付款處理失敗**
   - 檢查用戶資料是否完整
   - 確認訂單金額是否正確
   - 檢查資料庫連線是否正常

### **技術支持**

如遇到技術問題，請：
1. 查看 Laravel 日誌檔案
2. 檢查瀏覽器控制台錯誤訊息
3. 聯繫開發團隊協助

---

## 📈 **未來功能規劃**

1. **數據匯出**: 支援統計數據的 CSV/PDF 匯出
2. **圖表顯示**: 更豐富的視覺化圖表
3. **報表功能**: 自定義報表生成
4. **警報功能**: 異常情況自動通知
5. **審計日誌**: 更詳細的操作審計記錄

---

## 📝 **更新記錄**

### v1.0 (2025-11-09)
- ✅ 基礎系統管理頁面
- ✅ 統計數據顯示
- ✅ 訂單管理功能
- ✅ 手動付款處理
- ✅ 登入日誌記錄
- ✅ 權限控制

---

*本文檔會隨著功能更新持續維護，請定期檢查最新版本。*